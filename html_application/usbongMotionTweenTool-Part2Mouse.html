<!--
/*
' Copyright 2022~2023 USBONG
'
' Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You ' may obtain a copy of the License at
'
' http://www.apache.org/licenses/LICENSE-2.0
'
' Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, ' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing ' permissions and limitations under the License.
'
' @company: USBONG
' @author: SYSON, MICHAEL B.
' @date created: 20221214
' @date updated: 20230428; from 20230426
' @website: www.usbong.ph
'
'
' Notes:
' 1) website address: http://localhost/usbong_2DAnimationTool/html_application/usbongMotionTweenTool.html;
' last accessed: 20230410
'
' References:
' 1) https://phantomjs.org/; last accessed: 20200724
' downloaded phantomjs zipped file's examples: netsniff.js; last accessed: 20200725
'
' 2) https://nodejs.org/en/download/; last accessed: 20221214
' execute: .js file via: node halimbawa.js
' https://askubuntu.com/questions/1297994/what-is-the-simplest-way-to-run-javascript-code-on-ubuntu; last accessed: 20221214
'
' 3) http://localhost/usbong_2DAnimationTool/html_application/usbong2DAnimationTool.html;
' last accessed: 20230311
'
' 4) https://stackoverflow.com/questions/5027950/coordinates-for-my-javascript-game-based-on-an-angle-when-do-i-use-sin-cos-an;
' last accessed: 20230426
' answer by: Jimmy, 20110217T1212; from 20110217T1106
'
' 5) https://www.mathsisfun.com/sine-cosine-tangent.html;
' last accessed: 20230426
'
'*/
//added by Mike, 20230313
//TO-DO: -add: adjustable "STAGE" SIZE textbox
//TO-DO: -add: timeline?; remembers: DIRECTOR6, FLASH tool
//TO-DO: -note: location of image sprite file in assets folder, editable using GIMP tool
-->

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
<!-- TO-DO: -update: this -->
<!-- //edited by Mike, 20230314 //TO-DO: -add: option to set IF from internet
-->

<!--
  	<base href="http://localhost/usbong_2DAnimationTool/" target="_blank">
  	<base href="http://store.usbong.ph/" target="_blank">
-->

  </head>

  <title>
    Usbong Motion Tween Tool-Part2: MOUSE
  </title>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

  <style type="text/css">  
		html, body
        {
            font-family: Arial;
			font-size: 11pt;
				
			/* edited by Mike, 20220911
			width: 640px; 
			*/
			width: 100%; /*90%; 80%;*/
			height: 100%;
										
			padding: 0;
			margin: 0;
			
			/* //added by Mike, 20221002
			//reference: https://www.w3schools.com/howto/howto_css_disable_text_selection.asp;
			//last accessed: 20221002
			*/
			
			-webkit-user-select: none; /* Safari */
			-ms-user-select: none; /* IE 10 and IE 11 */
			user-select: none; /* Standard syntax */
			
			/* added by Mike, 20221012 */
			transform: scale(1.0);
			
			/* added by Mike, 20221119 */							
			touch-action: none;
		}  
  
		canvas.myCanvas {			
			padding: 0;
			margin: auto;							
			display: block;
			
/*
			width: 320px;
			height: 288px;	
*/

			width: 448px; /*640px;*/
			height: 402px; /*576px;*/
			
			border: 1px solid gray;

			z-index: -1;							
		}  

/*
		.Image32x32TileFrame1 {
			position: absolute;
  			clip: rect(0px,32px,32px,0px);
			
			visibility: hidden;			
		}
		.ImageTextInputSet32x32TileFrame2 {
			position: absolute;
  			clip: rect(0px,32px,32px,0px);
		}		  
*/
		.ImageTileFrame1 {
			position: absolute;
  			
  			/*clip: rect(0px,32px,32px,0px);*/
			
			visibility: hidden;						
		}

		.ButtonSet, .TextInputSet {		
			position: relative; /*absolute;*/			
			font-size: 20px;
		}
		
		.LabelSet {		
			position: relative; /*absolute;*/			
			font-size: 24px;
			
			font-weight: bolder; /*bold;*/
		}		
		
		.SelectAnimDirection {
			font-size: 22px;
		}
		
		table.TableSetPanel
		{
			position: absolute;
			border: 2px dotted #ab9c7d;		
			margin-top: 0px; /*10px*/
			
			visibility: hidden;
		}						

		
  </style>

  <script>  
	//added by Mike, 20221214
	var iCountMovementStep=0;
	const iCountInitMovementStepMax=15;
	const iCountMovementStepMax=100-iCountInitMovementStepMax;
	//edited by Mike, 20230421; from 20230418
	var iCountMovementStepDelay=0;
	const iCountMovementStepDelayMax=10;

	//added by Mike, 20230421
	//SOH-CAH-TOA
	//note: Max increase incrementally angle to end destination
	const iCountMovementDiagonalStepMax=5; //10 
	var iCountMovementDiagonalStep=iCountMovementDiagonalStepMax;
	//edited by Mike, 20230426; from 20230425
	//360 and 0, @12 o'clock; rotation; image and step direction
	//inverted y; 
	//SOH-CAH-TOA; where: use of cos and sin also interchanged;
	var iMainImageTileStepAngle=0;
    //var iMainImageTileStepAngleTemp=0;
    
    //added by Mike, 20230427
    var newMainImageTileProjectilePosX=0;
    var newMainImageTileProjectilePosY=0;
    var bHasFired=false;
    
	//added by Mike, 20230423
	var iMousePointPosX=0;
	var iMousePointPosY=0;
	
	var iPrevDirection=0;
	var bIsInitAutoGeneratePuzzleFromEnd=true;
	
	const iKEY_W = 0;
	const iKEY_S = 1;
	const iKEY_A = 2;
	const iKEY_D = 3;

	//edited by Mike, 20230418
/*
	const iKEY_I = 4;
	const iKEY_K = 5;
	const iKEY_J = 6;
	const iKEY_L = 7;
*/

	//added by Mike, 20230418
	const iKEY_Q = 4; //TOP-LEFT
	const iKEY_E = 5; //TOP-RIGHT
	const iKEY_C = 6; //BOTTOM-RIGHT
	const iKEY_Z = 7; //BOTTOM-LEFT
	
	const iKEY_I = 8;
	const iKEY_K = 9;
	const iKEY_J = 10;
	const iKEY_L = 11;

	//edited by Mike, 20230418
	const iTotalKeyCount = 12; //8; //4;	
	const iDirectionTotalKeyCount = 8; //4;	
	
	//added by Mike, 20230421
	var iDirection=-1;
	
	var arrayCountMovementStep= [];
	
	//added by Mike, 20230311
	var iFacingDirection=0;
	
	const iFACING_DOWN=0;
	const iFACING_UP=1;
	const iFACING_LEFT=2;
	const iFACING_RIGHT=3;	

	//edited by Mike, 20230314
	//note: VALUES set in init()
	//const iTotalAnimImageFrameCount=2;//6;
	var iTotalAnimImageFrameCount;//=4;//6;
	var iAnimImageFrameCount;//=0;	 
	
	var iDefaultAnimationImageX;//=0; //default x
	var iDefaultAnimationImageY;//=0;//-32; //default y
	
//	var iTotalAnimImageFrameCount=4;

	/*	//removed by Mike, 20230312
	var iImageFrameSizeX=0;
	var iImageFrameSizeY=32;
*/
	//added by Mike, 20230315
	//edited by Mike, 20230418
	//var iAnimImageDirection=0; //vertical
	var iAnimImageDirection=1; //horizontal

	const AnimImageDirection_VERTICAL=0;
	const AnimImageDirection_HORIZONTAL=1;

	
	var bIsWalkingAction=true; //false; 
		
	//edited by Mike, 20221129
	//1000/60=16.66; 60 frames per second
	//1000/30=33.33; 30 frames 
	const fFramesPerSecondDefault=16.66;
	//const fFramesPerSecondDefault=33.33;
	var fFramesPerSecond=fFramesPerSecondDefault;
	var iCurrentIntervalId=-1;	

	//edited by Mike, 20230315; from 20230311
	//adds 6 frames before frame update
	var iDelayAnimationCountMovementStep=0;
	var iDelayAnimationCountMovementStepMax=12; //6; 

	//added by Mike, 20230410
	var mainImageTilePosX=0;
	var mainImageTilePosY=0;
	//edited by Mike, 20230418
	var mainImageTileStepX=0; //2;
	var mainImageTileStepY=0; //2;
	
	//added by Mike, 20230427
	var mainImageTileProjectilePosX=0;
	var mainImageTileProjectilePosY=0;
	//edited by Mike, 20230418
	var mainImageTileProjectileStepX=2;//0; //2;
	var mainImageTileProjectileStepY=2;//0; //2;
		
	//edited by Mike, 20230314
/*	
	const iStageMaxWidth=160*2; //160;
	const iStageMaxHeight=144*2; //144;
*/
	//TO-DO: -add: auto-update Canvas' width and height to be EXACT
	var iStageMaxWidth=448; //640;
	var iStageMaxHeight=402; //576;

	var iHorizontalOffset=0;
	var iVerticalOffset=0;

	//note: for INNER SCREEN
	iHorizontalOffset=(screen.width)/2-iStageMaxWidth/2;	
	iVerticalOffsetInnerScreen=0;


	//added by Mike, 20230312
	//note: press TAB, then ENTER to SET		
	function setAnimImageFrameX() {	
		var setAnimImageFrameXText = document.getElementById("textSetAnimImageFrameXId");
		
		//notes: auto-sets to negative number;
		//TO-DO: -add: a checkbox as switch?
		if (setAnimImageFrameXText.value>0) {
			setAnimImageFrameXText.value=setAnimImageFrameXText.value*-1;
		}
		
		//alert(setAnimImageFrameXText.value);				
		iDefaultAnimationImageX=setAnimImageFrameXText.value;//-32;
	}

	function setAnimImageFrameY() {	
		var setAnimImageFrameYText = document.getElementById("textSetAnimImageFrameYId");
		
		//notes: auto-sets to negative number;
		//TO-DO: -add: a checkbox as switch?
		if (setAnimImageFrameYText.value>0) {
			setAnimImageFrameYText.value=setAnimImageFrameYText.value*-1;
		}
		
		//alert(setAnimImageFrameXText.value);				
		iDefaultAnimationImageY=setAnimImageFrameYText.value;//-32;
	}

	function setAnimImageFrameWidth() {	
		var setAnimImageFrameWidthText = document.getElementById("textSetAnimImageFrameWidthId");
				
		//alert(setAnimImageFrameXText.value);				
		iImageFrameWidth=setAnimImageFrameWidthText.value;//-32;		
	}
	
	function setAnimImageFrameHeight() {	
		var setAnimImageFrameHeightText = document.getElementById("textSetAnimImageFrameHeightId");
				
		//alert(setAnimImageFrameXText.value);				
		iImageFrameHeight=setAnimImageFrameHeightText.value;//-32;
	}
	
	function setAnimDelay() {	
		var setAnimDelayText = document.getElementById("textSetAnimDelayId");
					iDelayAnimationCountMovementStepMax=setAnimDelayText.value;
	}

	function setTotalAnimImageFrameCount() {	
		var setTotalAnimImageFrameCountText = document.getElementById("textSetTotalAnimImageFrameCountId");
	
		//notes: auto-sets to positive number;
		if (setTotalAnimImageFrameCountText.value<0) {
			setTotalAnimImageFrameCountText.value=setTotalAnimImageFrameCountText.value*-1;
		}
	
		//edited by Mike, 20230314
		iTotalAnimImageFrameCount=setTotalAnimImageFrameCountText.value;
	}
	
	//added by Mike, 20230410
	//reference: timeoff.php
	//TO-DO: -update: this
	//note: Carnage Heart from Videogame Magazines, Artificial Intelligence 
	//edited by Mike, 20230418
//	function autoGeneratePuzzleFromEnd() {
	//added: diagonal; combination of horizontal and vertical movements
	//TO-DO: -verify: ellipse movement;
	function autoIdentifyNextDirectionAI() {
		//edited by Mike, 20230418
		//sRecordedSteps="3121220312133003112111302212133333303312003030030303133122112122121303033033311212002";

		//edited by Mike, 20230419
		//sRecordedSteps="6666666666133003112111302212133333303312003030030303133122112122121303033033311212002";
		//edited by Mike, 20230421
//		sRecordedSteps="111111111116633333333333550000004422222222220";
//		sRecordedSteps="66";
//		sRecordedSteps="663355";//004422";
//		sRecordedSteps="66666663355";//004422";
		sRecordedSteps="6666666333550004422277111";

/*
		var puzzleRecordedStepsSpan = document.getElementById("puzzleRecordedStepsId");
		sRecordedSteps=puzzleRecordedStepsSpan.innerHTML;
*/
		
	/*
		arrayKeyPressed[iKEY_A]=true;	
		arrayKeyPressed[iKEY_K]=true;
	*/

/* //added by Mike, 20230418
		mainImageTileStepX=2;
		mainImageTileStepY=0;
				
		return;
*/	
		
		//reference: https://www.w3schools.com/jsref/jsref_random.asp;
		//last accessed: 20221108
		//number between 0 and 4; integer only	
	//	for (iCount=0; iCount<iCountMovementStepMax; iCount++) {
		
		if (iCountMovementStepDelay<iCountMovementStepDelayMax) {
			iCountMovementStepDelay=iCountMovementStepDelay+1;
			return;
		}
		else {
			iCountMovementStepDelay=0;
		}
		
		if (iCountMovementStep<iCountMovementStepMax) {
			
			//edited by Mike, 20221214; from 20221129
			//random
			//let iDirection = window.parseInt(Math.random() * 4);	
			
			//OK
			//edited by Mike, 20230421
			//let iDirection=parseInt(sRecordedSteps.substr(iCountMovementStep,1));		
			iDirection=parseInt(sRecordedSteps.substr(iCountMovementStep,1));		
						
			switch (iDirection) {
				case iKEY_W: //0
/*
					arrayKeyPressed[iKEY_W]=true;	
					arrayKeyPressed[iKEY_K]=true;						
*/					
					mainImageTileStepX=0;
					mainImageTileStepY=-2;
					
					//added by Mike, 20230421
					//iMainImageTileStepAngleiMainImageTileStepAngle=0;					
					break;	
				case iKEY_S: //1
/*
					arrayKeyPressed[iKEY_S]=true;	
					arrayKeyPressed[iKEY_K]=true;
*/
					mainImageTileStepX=0;
					mainImageTileStepY=2;

					//added by Mike, 20230421
					//iMainImageTileStepAngle=0;					
					break;	
				case iKEY_A: //2
/*
					arrayKeyPressed[iKEY_A]=true;	
					arrayKeyPressed[iKEY_K]=true;
*/					
					mainImageTileStepX=-2;
					mainImageTileStepY=0;

					//added by Mike, 20230421
					//iMainImageTileStepAngle=0;					
					break;	
				case iKEY_D: //3
/*
					arrayKeyPressed[iKEY_D]=true;	
					arrayKeyPressed[iKEY_K]=true;
*/					
					mainImageTileStepX=2;
					mainImageTileStepY=0;

					//added by Mike, 20230421
					//iMainImageTileStepAngle=0;					
					break;	

				//DIAGONAL PART
				case iKEY_Q: //4; TOP-LEFT
					mainImageTileStepX=-2;
					mainImageTileStepY=-2;
					
					//added by Mike, 20230421
					iMainImageTileStepAngle=90+45;

/*					//removed by Mike, 20230422					
					if (iCountMovementDiagonalStep<iCountMovementDiagonalStepMax) {
						iCountMovementDiagonalStep++;
						return;
					}
					else {
						iCountMovementDiagonalStep=0;
					}
*/					
					break;	
				case iKEY_E: //5; TOP-RIGHT
					mainImageTileStepX=2;
					mainImageTileStepY=-2;

					//added by Mike, 20230421
					//alert(iMainImageTileStepAngle);
					//alert("iCountMovementDiagonalStep: "+iCountMovementDiagonalStep);
					
					//iMainImageTileStepAngle=(360-iMainImageTileStepAngle)+45;
					iMainImageTileStepAngle=45;

/*					//removed by Mike, 20230422
					if (iCountMovementDiagonalStep<iCountMovementDiagonalStepMax) {
						iCountMovementDiagonalStep++;
						return;
					}
					else {
						iCountMovementDiagonalStep=0;
					}
*/					
					break;	
				case iKEY_C: //6; BOTTOM-RIGHT
					mainImageTileStepX=2;
					mainImageTileStepY=2;
					
					//alert(iCountMovementDiagonalStep);

					//added by Mike, 20230421
					iMainImageTileStepAngle=270+45;

/*					//removed by Mike, 20230422
					if (iCountMovementDiagonalStep<iCountMovementDiagonalStepMax) {
						iCountMovementDiagonalStep++;
						return;
					}
					else {
						iCountMovementDiagonalStep=0;
					}
*/					
					break;	
				case iKEY_Z: //7; BOTTOM-LEFT
					mainImageTileStepX=-2;
					mainImageTileStepY=2;					

					//added by Mike, 20230421
					iMainImageTileStepAngle=180+45;

/*					//removed by Mike, 20230422
					if (iCountMovementDiagonalStep<iCountMovementDiagonalStepMax) {
						iCountMovementDiagonalStep++;
						return;
					}
					else {
						iCountMovementDiagonalStep=0;
					}
*/					
					break;						
			}
	
/*	
			//added by Mike, 20221214
			arrayCountMovementStep[iCountMovementStep]=iDirection;
*/				
			
			iCountMovementStep++;
		}	
		else {		
			bIsInitAutoGeneratePuzzleFromEnd=false;

	/*		//TO-DO: -add: in Database, with datetime stamp
			//added by Mike, 20221214
			var sRecordedSteps="";
			
			for (let iCount=0; iCount<iCountMovementStep; iCount++) {		
				sRecordedSteps=sRecordedSteps.concat(arrayCountMovementStep[iCount]);
			}
			
			
			//OK
			//example output: 3121220312133003112111302212133333303312003030030303133122112122121303033033311212002
			alert(sRecordedSteps);
	*/				
		}	
		
	}
	
	//added by Mike, 20230427
	function resetProjectile() {
		var mainImageTileProjectile = document.getElementById("mainImageTileProjectileImageId");
		
		//added by Mike, 20230427
		mainImageTileProjectilePosX=iStageMaxWidth/2-iImageFrameWidth/2;
		mainImageTileProjectilePosY=iStageMaxHeight/2-iImageFrameHeight/2;
		
		//TO-DO: -update: newMainImage... step
		newMainImageTileProjectilePosX=0; //mainImageTileProjectilePosX;
		newMainImageTileProjectilePosY=0; //mainImageTileProjectilePosY;
		
		mainImageTileProjectile.style.left = (iHorizontalOffset+mainImageTilePosX)+"px";	
		
		mainImageTileProjectile.style.top = (iVerticalOffsetInnerScreen+mainImageTilePosY)+"px";	
		
		mainImageTileProjectile.style.visibility="hidden";
		bHasFired=false;		
		
		//alert("dito");
	}

	//added by Mike, 20230312	
	//TO-DO: -update: variable container names
	//TO-DO: -fix: SET button NOT focused on SAFARI
	function init() {			
		//TO-DO: -update: this; add in window, input boxes 
		//note: parameters		
		iDefaultAnimationImageX=0;//-32; //default x		
 		iDefaultAnimationImageY=0;//-32; //default y

		//edited by Mike, 20230418
		//iTotalAnimImageFrameCount=4;//2;
		iTotalAnimImageFrameCount=2;

		//edited by Mike, 20230322
		iImageFrameWidth=64;// 32; //0;
		iImageFrameHeight=64;// 32;		

		var setAnimImageFrameWidthText = document.getElementById("textSetAnimImageFrameWidthId");
		var setAnimImageFrameHeightText = document.getElementById("textSetAnimImageFrameHeightId");

		var setAnimImageFrameXText = document.getElementById("textSetAnimImageFrameXId");
		var setAnimImageFrameYText = document.getElementById("textSetAnimImageFrameYId");

		var setTotalAnimImageFrameCountText = document.getElementById("textSetTotalAnimImageFrameCountId");
		
		var setAnimDelayText = document.getElementById("textSetAnimDelayId");
				
		//added by Mike, 20230315
		var setPanelTable = document.getElementById("tableSetPanelId");
		var mainImageTile = document.getElementById("mainImageTileImageId");
		
		var mainImageTileProjectile = document.getElementById("mainImageTileProjectileImageId");
					
				
		setAnimImageFrameWidthText.value=iImageFrameWidth;
		setAnimImageFrameHeightText.value=iImageFrameHeight;

		setAnimImageFrameXText.value=iDefaultAnimationImageX;
		setAnimImageFrameYText.value=iDefaultAnimationImageY;

		//added by Mike, 20230314	
	setTotalAnimImageFrameCountText.value=iTotalAnimImageFrameCount;
		//added by Mike, 20230315
setAnimDelayText.value=iDelayAnimationCountMovementStepMax;
				

		//added by Mike, 20230315
		setPanelTable.style.left = (iHorizontalOffset+iStageMaxWidth)+"px";	
		setPanelTable.style.top = (iVerticalOffsetInnerScreen)+"px";
		setPanelTable.style.visibility = "visible";
		
		//removed by Mike, 20230321
		//mainImageTile.style.visibility = "visible";
		
		//added by Mike, 20230423
		mainImageTilePosX=iStageMaxWidth/2-iImageFrameWidth/2;
		mainImageTilePosY=iStageMaxHeight/2-iImageFrameHeight/2;
		mainImageTile.style.left = (iHorizontalOffset+mainImageTilePosX)+"px";	
		mainImageTile.style.top = (iVerticalOffsetInnerScreen+mainImageTilePosY)+"px";

		//added by Mike, 20230427
		mainImageTileProjectilePosX=iStageMaxWidth/2-iImageFrameWidth/2;
		mainImageTileProjectilePosY=iStageMaxHeight/2-iImageFrameHeight/2;
		
		//TO-DO: -update: "newMain" to ..."step"
		newMainImageTileProjectilePosX=0;//mainImageTileProjectilePosX;
		newMainImageTileProjectilePosY=0;//mainImageTileProjectilePosY;
				
		mainImageTileProjectile.style.left = (iHorizontalOffset+mainImageTilePosX)+"px";	
		
		mainImageTileProjectile.style.top = (iVerticalOffsetInnerScreen+mainImageTilePosY)+"px";	

	}
	
	function myUpdateFunction() {	
		var mainImageTile = document.getElementById("mainImageTileImageId");
		//added by Mike, 20230427
		var mainImageTileProjectile = document.getElementById("mainImageTileProjectileImageId");
		
		//var setAnimImageFrameXButton = document.getElementById("buttonSetAnimImageFrameXId");
		var setPanelTable = document.getElementById("tableSetPanelId");

		var setAnimImageFrameWidthText = document.getElementById("textSetAnimImageFrameWidthId");
		var setAnimImageFrameHeightText = document.getElementById("textSetAnimImageFrameHeightId");
	
		//added by Mike, 20230315
		var animDirectionSelectedIndex = document.getElementById("selectAnimDirectionId").selectedIndex;
			
		//added by Mike, 20230313
		//reference: https://www.w3schools.com/tags/canvas_fillrect.asp; 
		//last accessed: 2020911
		var myCanvas = document.getElementById("myCanvasId");
		var myCanvasContext = myCanvas.getContext("2d");

		//myCanvasContext.clearRect(0, 0, iStageMaxWidth, iStageMaxHeight);
		
		//myCanvasContext.fillStyle = "#000000"; //black; //"#ababab"; //"rgb(128,89,27)"; //"#604122"; //"blue";	
		
		//myCanvasContext.fillStyle = "#c5c5c5"; //gray
		myCanvasContext.fillStyle = "#ffffff"; //white background//stage
		
		myCanvasContext.fillRect(0, 0, iStageMaxWidth, iStageMaxHeight);	
	
//alert (iHorizontalOffset);

		//added by Mike, 20221002; edited by Mike, 20221005
		//myCanvas.style.top = (0)+"px"; //iVerticalOffset+
		myCanvas.style.top = (iVerticalOffsetInnerScreen+0)+"px"; //iVerticalOffset+

		//added by Mike, 20221012
		iHorizontalOffset=myCanvas.getBoundingClientRect().x;

 //removed by Mike, 20230424
		//edited by Mike, 20230423; from 20230321
		mainImageTile.style.clip = "rect(0px "+iImageFrameWidth+"px "+iImageFrameHeight+"px 0px)"; 
		
		//added by Mike, 20230427
//		mainImageTileProjectile.style.clip = "rect("+iImageFrameWidth*2+"px "+iImageFrameWidth+"px "+iImageFrameHeight+"px "+iImageFrameWidth*2+"px)";

		mainImageTileProjectile.style.clip = "rect(0px "+iImageFrameWidth+"px "+iImageFrameHeight+"px 0px)"; 

//reference: https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin; last accessed: 20230424
//note: transform rotate uses whole unclipped image size; 256x256px
//25%/2 = 12.5%
mainImageTile.style.transformOrigin = "12.5% 12.5%";


//clockwise
//iMainImageTileStepAngle=(iMainImageTileStepAngle+1)%360;
//counter-clockwise	
//iMainImageTileStepAngle=(iMainImageTileStepAngle-1)%360;

//edited by Mike, 20230427
if (!bHasFired) {
//clockwise
iMainImageTileStepAngle=(iMainImageTileStepAngle+1)%360;

					mainImageTile.style.transform = "rotate("+ (iMainImageTileStepAngle % 360) +"deg)";
}

//mainImageTile.style.transform = "rotate("+ (fMainImageTileStepAngleDegrees % 360) +"deg)";



/*
iMainImageTileStepAngle+=5;

	var fMainImageTileStepAngleRad=iMainImageTileStepAngle*Math.PI/180.0;		

mainImageTile.style.transform = "rotate("+ (iMainImageTileStepAngle % 360) +"deg)";
					
			
			
mainImageTileStepX=15; //2;
					mainImageTileStepY=15; //2;	

					//note: negative; due to inverted y-axis
					//newMainImageTilePosY=mainImageTileStepX/Math.sin(fMainImageTileStepAngleRad).toFixed(3);				
				newMainImageTilePosY=mainImageTileStepY*Math.cos(fMainImageTileStepAngleRad).toFixed(3);				

//					alert(newMainImageTilePosY);				
					newMainImageTilePosY*=-1;


					//newMainImageTilePosX=mainImageTileStepY/Math.cos(fMainImageTileStepAngleRad).toFixed(3);
										newMainImageTilePosX=mainImageTileStepX*Math.sin(fMainImageTileStepAngleRad).toFixed(3);
										
							
							mainImageTilePosY=mainImageTilePosY+newMainImageTilePosY;
					mainImageTilePosX=mainImageTilePosX+newMainImageTilePosX;
									
					//alert("mainImageTileStepX: "+mainImageTileStepX);					
					//alert("mainImageTilePosY Part1: "+mainImageTilePosY);
		mainImageTile.style.left = (iHorizontalOffset+mainImageTilePosX)+"px";	
		mainImageTile.style.top = (iVerticalOffsetInnerScreen+mainImageTilePosY)+"px";
		*/
		
													
			
		//notes: delay before CHANGE in frame
		//adds max (12) frames before frame update
		if (iDelayAnimationCountMovementStep<iDelayAnimationCountMovementStepMax) {
			iDelayAnimationCountMovementStep++;
		}
		else {
			iDelayAnimationCountMovementStep=0;
						
			//updated: IF using > 2 animating image frames
/*
			if (iAnimImageFrameCount<iTotalAnimImageFrameCount) {				
				//alert("iAnimImageFrameCount: "+iAnimImageFrameCount);
	
				if (iFacingDirection==iFACING_DOWN) {
					//edited by Mike, 20221117
					//mainImageTile.style.objectPosition="0px 0px";
					
					if (bIsWalkingAction) {
						mainImageTile.style.objectPosition="0px -32px";
					}
					else {
						mainImageTile.style.objectPosition="0px 0px";
					}
				}
				else if (iFacingDirection==iFACING_RIGHT) {
					if (bIsWalkingAction) {
						mainImageTile.style.objectPosition="-64px -32px";
					}
					else {			
						mainImageTile.style.objectPosition="-64px 0px";
					}
				}
				else if (iFacingDirection==iFACING_LEFT) {
					if (bIsWalkingAction) {
						mainImageTile.style.objectPosition="-128px -32px";
					}
					else {
						mainImageTile.style.objectPosition="-128px 0px";
					}
				}	
				else if (iFacingDirection==iFACING_UP) {
					if (bIsWalkingAction) {
						mainImageTile.style.objectPosition="-32px -32px";
					}
					else {
						mainImageTile.style.objectPosition="-192px 0px";
					}
				}		
				
				iAnimImageFrameCount++;	
			}
			else {
				if (iFacingDirection==iFACING_DOWN) {
					if (bIsWalkingAction) {
						mainImageTile.style.objectPosition="0px -64px";
					}
					else {			
						mainImageTile.style.objectPosition="-32px 0px";
					}
				}
				else if (iFacingDirection==iFACING_RIGHT) {
					if (bIsWalkingAction) {
						mainImageTile.style.objectPosition="-64px -64px";
					}
					else {			
						mainImageTile.style.objectPosition="-96px 0px";
					}
				}
				else if (iFacingDirection==iFACING_LEFT) {
					if (bIsWalkingAction) {
						mainImageTile.style.objectPosition="-128px -64px";
					}
					else {			
						mainImageTile.style.objectPosition="-160px 0px";
					}
				}
				else if (iFacingDirection==iFACING_UP) {
					if (bIsWalkingAction) {
						mainImageTile.style.objectPosition="-32px -64px";
					}
					else {			
						mainImageTile.style.objectPosition="-224px 0px";
					}
				}		
		
				iAnimImageFrameCount=0;
			}			
*/			


			if (animDirectionSelectedIndex==AnimImageDirection_VERTICAL) {
				mainImageTile.style.objectPosition=(iDefaultAnimationImageX-(0))+"px "+
										   	(iDefaultAnimationImageY-(iAnimImageFrameCount*iImageFrameHeight))+"px";	
			}
			//AnimImageDirection_HORIZONTAL
			else {
				mainImageTile.style.objectPosition=(iDefaultAnimationImageX-(iAnimImageFrameCount*iImageFrameWidth))+"px "+(iDefaultAnimationImageY-(0))+"px";	
			}
			
			if (iAnimImageFrameCount<(iTotalAnimImageFrameCount-1)) {	
				iAnimImageFrameCount++;
			}
			else {
				iAnimImageFrameCount=0;
			}			
		}

/*	//removed by Mike, 20230425
		mainImageTile.style.left = (iHorizontalOffset)+mainImageTilePosX+"px";		
		mainImageTile.style.top = (iVerticalOffsetInnerScreen)+mainImageTilePosY+"px";	
*/
		

	  //added by Mike, 20230427
	  //movement
	  if (bHasFired) {
/*
//alert("mainImageTileProjectilePosY: "+mainImageTileProjectilePosY);	
mainImageTileProjectilePosY=mainImageTileProjectilePosY+newMainImageTileProjectilePosY;
//alert("newMainImageTileProjectilePosY: "+newMainImageTileProjectilePosY);
					mainImageTileProjectilePosX=mainImageTileProjectilePosX+newMainImageTileProjectilePosX;
*/
mainImageTileProjectilePosY=mainImageTileProjectilePosY+newMainImageTileProjectilePosY;
					mainImageTileProjectilePosX=mainImageTileProjectilePosX+newMainImageTileProjectilePosX;

/*
mainImageTileProjectilePosY++;
//alert("newMainImageTileProjectilePosY: "+newMainImageTileProjectilePosY);
					mainImageTileProjectilePosX++;								*/	
					//alert("mainImageTileStepX: "+mainImageTileStepX);										
mainImageTileProjectile.style.visibility = "visible";					
					
					
		mainImageTileProjectile.style.left = (iHorizontalOffset)+mainImageTileProjectilePosX+"px";		
		mainImageTileProjectile.style.top = (iVerticalOffsetInnerScreen)+mainImageTileProjectilePosY+"px";	

/*
		mainImageTileProjectile.style.left = (iHorizontalOffset+mainImageTilePosX)+mainImageTileProjectilePosX+"px";		
		
		mainImageTileProjectile.style.top = (iVerticalOffsetInnerScreen+mainImageTilePosY)+mainImageTileProjectilePosY+"px";	
*/

//STAGE; MAX
//TO-DO: -fix: this
	
//		if (mainImageTileProjectilePosX+iImageFrameWidth>iHorizontalOffset+iStageMaxWidth) {

	//edited by Mike, 20230428; OK; inside stage border;
		if (mainImageTileProjectilePosX+iImageFrameWidth>iStageMaxWidth) {
			resetProjectile();	
		}
		else if (mainImageTileProjectilePosX<0){//+iHorizontalOffset) {		
				resetProjectile();			
		}
//		if (mainImageTileProjectilePosY+iImageFrameHeight>iVerticalOffset+iStageMaxHeight) {

		if (mainImageTileProjectilePosY+iImageFrameHeight>iStageMaxHeight) {
			resetProjectile();
		}
//		else if (mainImageTileProjectilePosY<0+iVerticalOffset) {		
		else if (mainImageTileProjectilePosY<0) {
			resetProjectile();		
		}

/* //outside stage border;
		if (mainImageTileProjectilePosX>iStageMaxWidth) {
			resetProjectile();	
		}
		else 
		if (mainImageTileProjectilePosX+iImageFrameWidth<0) {
				resetProjectile();			
		}

		if (mainImageTileProjectilePosY>iStageMaxHeight) {
			resetProjectile();
		}
		else if (mainImageTileProjectilePosY+iImageFrameHeight<0) {
			resetProjectile();		
		}
*/		
		
	  }

//		mainImageTilePosX++;
//		mainImageTilePosX--;
//		mainImageTilePosY++;
				
		//edited by Mike, 20230423; from 20230418
		//autoIdentifyNextDirectionAI();
		//autoIdentifyNextDirectionAIPart2Mouse();

		//edited by Mike, 20230421
/*
		mainImageTilePosX+=mainImageTileStepX; //horizontal movement;
		mainImageTilePosY+=mainImageTileStepY; //goes downward; vertical
*/


		
		//TO-DO: -add: function; AI; Artificial Intelligence
		//combination of forward, diagonal movements
				
		//STAGE; MAX
		if (mainImageTilePosX+iImageFrameWidth>iStageMaxWidth) {
			mainImageTilePosX=iStageMaxWidth-iImageFrameWidth;
		}
		else if (mainImageTilePosX<0) {
			mainImageTilePosX=0;
		}

		if (mainImageTilePosY+iImageFrameHeight>iStageMaxHeight) {
			mainImageTilePosY=iStageMaxHeight-iImageFrameHeight;
		}
		else if (mainImageTilePosY<0) {
			mainImageTilePosY=0;
		}

		
		//edited by Mike, 20230423; from 20230321;
		mainImageTile.style.visibility = "visible";
		//mainImageTile.style.visibility = "hidden";
		
		//removed by Mike, 20230427
		//mainImageTileProjectile.style.visibility = "visible";

	

/*		
		setAnimImageFrameXButton.style.left = (iHorizontalOffset+iStageMaxWidth)+"px";	
		setAnimImageFrameXButton.style.top = (iVerticalOffsetInnerScreen)+"px"; //+iStageMaxHeight
*/		


		//added by Mike, 20230428
		mainImageTilePosX=iStageMaxWidth/2-iImageFrameWidth/2;
		mainImageTilePosY=iStageMaxHeight/2-iImageFrameHeight/2;
		mainImageTile.style.left = (iHorizontalOffset+mainImageTilePosX)+"px";	
		mainImageTile.style.top = (iVerticalOffsetInnerScreen+mainImageTilePosY)+"px";



		setPanelTable.style.left = (iHorizontalOffset+iStageMaxWidth)+"px";	
		setPanelTable.style.top = (iVerticalOffsetInnerScreen)+"px"; //+iStageMaxHeight
	}

	//added by Mike, 20230423
	function processMouseInput() {	
		//reference: https://stackoverflow.com/questions/70827887/detect-click-vs-touch-in-javascript;
		//last accessed: 20221110
		//answer by:  Jacob, 20220124T0110
		document.body.addEventListener('pointerdown', (event) => {
			//reference: https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pointerType;
			//last accessed: 20221122
			switch(event.pointerType) {
				case 'mouse':		
/*				
					if (bIsUsingAppleWebKit) {
					  bIsUsingAppleMac=true;
					}
*/
					//note: ZOOM function causes position ERROR via screenX
					var iXPos = event.clientX;//screenX;

					//note: screenY includes BROWSER address bar, et cetera;
					var iYPos = event.pageY; //screenY;

/*					//edited by Mike, 20230423
					alert("iXPos: "+iXPos);
					alert("iYPos: "+iYPos);		
*/

					var mainImageTile = document.getElementById("mainImageTileImageId");

//iMainImageTileStepAngleTemp+=10;
//iMainImageTileStepAngleTemp=90;

					//note: start 0 @clock 12 o'clock; clock-wise

/*					iMainImageTileStepAngle=(iMainImageTileStepAngle+10)%360;
*/										
					//alert(iMainImageTileStepAngle);
/*	
					//added by Mike, 20230427
newMainImageTilePosY=mainImageTileStepY*Math.cos(fMainImageTileStepAngleRad).toFixed(3);				

//					alert(newMainImageTilePosY);				
					newMainImageTilePosY*=-1;
										newMainImageTilePosX=mainImageTileStepX*Math.sin(fMainImageTileStepAngleRad).toFixed(3);
*/										

	
/*	
	iYPos=iYPos-(mainImageTilePosY+iVerticalOffsetInnerScreen);
	iXPos=iXPos-(mainImageTilePosX+iHorizontalOffset);
	
	alert("iYPos: "+iYPos);
	alert("iXPos: "+iXPos);
	
	if (iYPos<0) {
		iYPos*=-1;
	}
	if (iXPos<0) {
		iXPos*=-1;
	}
*/	
	
					//adds: image's top
					//edited by Mike, 20230425
					//counter-clockwise; 
					//note: equation; output, correct; quadrants;	
				//iMainImageTileStepAngleTemp=((-1*iMainImageTileStepAngle+90)%(360+90))%360;

/*					
					var fMainImageTileStepAngleRad=iMainImageTileStepAngle*Math.PI/180.0;		
					*/
	
					//alert(fMainImageTileStepAngleRad);

					mainImageTileStepX=14; //2;
					mainImageTileStepY=14; //2;	

					
///TO-DO: -compute: angle based on mouse position;

//newMainImageTilePosY=mainImageTileStepY*Math.cos(fMainImageTileStepAngleRad).toFixed(3);		

					//var iYPosTemp=iYPos*-1;
					
					//alert(iYPosTemp);	
					
					//alert(iYPos);
					
					//note: object @center
					//mainImageTileStepX=mainImageTileStepX-iXPos


//Reference#1:https://www.mathsisfun.com/algebra/trig-finding-angle-right-triangle.html; last accessed: 20230427
//angle = atan(O/A)

//Reference#2: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/atan2; last accessed: 202304287

//iMainImageTileStepAngle=Math.atan(300/400).toFixed(3);
//iMainImageTileStepAngle=Math.atan(-iYPos/iXPos).toFixed(3);
/*
//TO-DO: -fix: this
iMainImageTileStepAngle=Math.atan2(iYPos,iXPos).toFixed(3);
						var fMainImageTileStepAngleDegrees=iMainImageTileStepAngle*180.0/Math.PI;	
*/

					var fMainImageTileStepAngleRad=iMainImageTileStepAngle*Math.PI/180.0;	
					

			
//fMainImageTileStepAngleDegrees = (fMainImageTileStepAngleDegrees + 360) % 360;  // +360 for implementations where mod returns negative numbers

//					alert(newMainImageTilePosY);				
/*
alert("iYPos: "+iYPos);	
alert("iXPos: "+iXPos);

alert("iMainImageTileStepAngle: "+iMainImageTileStepAngle);
alert("fMainImageTileStepAngleDegrees: "+fMainImageTileStepAngleDegrees);
*/			

/*
			iMainImageTileStepAngle=fMainImageTileStepAngleDegrees;
*/					

//alert(iMainImageTileStepAngle);


/* //edited by Mike, 20230427	
//note: negative; due to inverted y-axis
					//newMainImageTilePosY=mainImageTileStepX/Math.sin(fMainImageTileStepAngleRad).toFixed(3);				
			newMainImageTilePosY=mainImageTileStepY*Math.cos(fMainImageTileStepAngleRad).toFixed(3);				

//					alert(newMainImageTilePosY);				
					newMainImageTilePosY*=-1;


					//newMainImageTilePosX=mainImageTileStepY/Math.cos(fMainImageTileStepAngleRad).toFixed(3);
										newMainImageTilePosX=mainImageTileStepX*Math.sin(fMainImageTileStepAngleRad).toFixed(3);
*/

mainImageTileProjectileStepY=20;
mainImageTileProjectileStepX=20;


newMainImageTileProjectilePosY=mainImageTileProjectileStepY*Math.cos(fMainImageTileStepAngleRad).toFixed(3);

//start position @center
//newMainImageTileProjectilePosY+=iVerticalOffsetInnerScreen+mainImageTilePosY;
//newMainImageTileProjectilePosY=(iVerticalOffsetInnerScreen+mainImageTilePosY+mainImageTileProjectileStepY)*Math.cos(fMainImageTileStepAngleRad).toFixed(3);

					newMainImageTileProjectilePosY*=-1;	
												newMainImageTileProjectilePosX=mainImageTileProjectileStepX*Math.sin(fMainImageTileStepAngleRad).toFixed(3);

//newMainImageTileProjectilePosX=(iHorizontalOffset+mainImageTilePosX+mainImageTileProjectileStepX)*Math.sin(fMainImageTileStepAngleRad).toFixed(3);
	


					bHasFired=true;

/*
					alert("newMainImageTileProjectilePosY: "+newMainImageTileProjectilePosY);
											alert("newMainImageTileProjectilePosX: "+newMainImageTileProjectilePosX);		*/
																
					//reference: https://stackoverflow.com/questions/8388440/converting-a-double-to-an-int-in-javascript-without-rounding; last accessed: 20230425
					//answer by: kubetz, 20111205T1630
					//edited by: Rooke, 20160329T1858

					//identify the quadrant; start @1
					var iQuadrant = parseInt(iMainImageTileStepAngle/90,10)+1;					
					//alert(iQuadrant);
/*
					switch (iQuadrant) {
						case 1:
							mainImageTileStepX=2;
							mainImageTileStepY=-2;							
							break;
						case 2:
							mainImageTileStepX=-2;
							mainImageTileStepY=-2;							
							break;
						case 3:
							mainImageTileStepX=-2;
							mainImageTileStepY=2;							
							break;
						case 4:
							mainImageTileStepX=2;
							mainImageTileStepY=2;							
							break;							
					}
*/

/*
				    //movement
					mainImageTilePosY=mainImageTilePosY+newMainImageTilePosY;
					mainImageTilePosX=mainImageTilePosX+newMainImageTilePosX;
									
					//alert("mainImageTileStepX: "+mainImageTileStepX);					
					//alert("mainImageTilePosY Part1: "+mainImageTilePosY);
		mainImageTile.style.left = (iHorizontalOffset+mainImageTilePosX)+"px";	
		mainImageTile.style.top = (iVerticalOffsetInnerScreen+mainImageTilePosY)+"px";
*/		
		
					break;
				case 'touch':
/*				
					//alert("TOUCH");		  
					if (bIsUsingAppleWebKit) {
					  //added by Mike, 20221111; removed by Mike, 20221118
					  //note: NOT yet set
					  if (bIsUsingAppleMac) {
						toggleFullScreen();
					  }

					  bIsUsingAppleMac=false;
					  bIsMobile=true; //added by Mike, 20221110			
					  
					  //added by Mike, 20230111
					  bHasSetMaxWidthHeight=true;
					}
*/					
					break;
			}
		});
	}
	
	function onLoad() {
/*	
		while (bIsInitAutoGeneratePuzzleFromEnd) {
			autoGeneratePuzzleFromEndForStorage();
		}
*/		
		//TO-DO: -update: this; add bIsNotEnd
/*		
		while (true) {
			iFacingDirection=iFACING_DOWN;		
			miniGameActionUpdate();
		}
*/		

		init();

		iFacingDirection=iFACING_DOWN;

		//added by Mike, 20230423
		processMouseInput();
		
		fFramesPerSecond=16.66; //100.00; //16.66;				
		clearInterval(iCurrentIntervalId);
		iCurrentIntervalId=setInterval(myUpdateFunction, fFramesPerSecond);
	}
	
  </script>  
  <body id="myBodyId" onload="onLoad();">
  
	<canvas id="myCanvasId" class="myCanvas">
	</canvas>
	  
<!-- note: using absolute positions; table technique NO EFFECT
	<table>
	<tr>
		<td>
		</td>
		<td>
		</td>
	</tr>
	</table>
-->

		<!--HALLO!-->
<!--
		<img id="mainImageTileImageId" class="Image32x32TileFrame1" src="assets/images/human.png">	
-->		
<!-- edited by Mike, 20230424
		<img id="mainImageTileImageId" class="ImageTileFrame1" src="assets/images/inputImage.png">	
-->

<!-- noted by Mike, 20230424; 

reference: https://stackoverflow.com/questions/5713295/specify-a-root-path-of-your-html-directory-for-script-links/41011179#41011179; last accessed: 20230424;
answer by: MistyDawn, 20161207T0655;
edited by: Huy Nguyen, 20170124T0455

/ means the root of the current drive;
./ means the current directory;
../ means the parent of the current directory.

-->

		<img id="mainImageTileImageId" class="ImageTileFrame1" src="../assets/images/inputImage.png">	
		
		<img id="mainImageTileProjectileImageId" class="ImageTileFrame1" src="../assets/images/inputImage.png">	

	<table class="TableSetPanel" id="tableSetPanelId">
	<tr>
		<td>
			<label class="LabelSet">Set Image Frame W:</label>
			<br/>
			<input type="number" class="TextInputSet" id="textSetAnimImageFrameWidthId">
			<button class="ButtonSet" id="buttonSetAnimImageFrameWidthId" onclick="setAnimImageFrameWidth()">SET</button>
		</td>
	</tr>
	<tr>
		<td>
			<label class="LabelSet">Set Image Frame H:</label>
			<br/>
			<input type="number" class="TextInputSet" id="textSetAnimImageFrameHeightId">
			<button class="ButtonSet" id="buttonSetAnimImageFrameHeightId" onclick="setAnimImageFrameHeight()">SET</button>
		</td>
	</tr>

	<tr>
		<td>
			<br/>
		</td>
	</tr>


	<tr>
		<td>
			<label class="LabelSet">Set Image Frame X:</label>
			<br/>
			<input type="number" class="TextInputSet" id="textSetAnimImageFrameXId">
			<button class="ButtonSet" id="buttonSetAnimImageFrameXId" onclick="setAnimImageFrameX()">SET</button>
		</td>
	</tr>
	<tr>
		<td>
			<label class="LabelSet">Set Image Frame Y:</label>
			<br/>
			<input type="number" class="TextInputSet" id="textSetAnimImageFrameYId">
			<button class="ButtonSet" id="buttonSetAnimImageFrameYId" onclick="setAnimImageFrameY()">SET</button>
		</td>
	</tr>
	<tr>
		<td>
			<br/>
		</td>
	</tr>
	
	
	<tr>
		<td>
			<label class="LabelSet">Set TOTAL Frame Count:</label>
			<br/>
			<input type="number" class="TextInputSet" id="textSetTotalAnimImageFrameCountId">
			<button class="ButtonSet" id="buttonSetTotalAnimImageFrameCountId" onclick="setTotalAnimImageFrameCount()">SET</button>
		</td>
	</tr>

	<tr>
		<td>
			<label class="LabelSet">Set DELAY Frame Count:</label>
			<br/>
			<input type="number" class="TextInputSet" id="textSetAnimDelayId">
			<button class="ButtonSet" id="buttonSetAnimDelayId" onclick="setAnimDelay()">SET</button>
		</td>
	</tr>

	<tr>
		<td>
			<br/>
		</td>
	</tr>
	<tr>
		<td>
			<label class="LabelSet">Animation Frame Direction:</label>
			<br/>
			<select id="selectAnimDirectionId" class="SelectAnimDirection">
  				<option value="VERTICAL">VERTICAL</option>
  				<option value="HORIZONTAL">HORIZONTAL</option>
			</select>
		</td>
	</tr>
	
	</table>

  </body>
</html>
